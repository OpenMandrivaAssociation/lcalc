--- L-1.23/src/Lcommandline_elliptic.cc.orig	2010-11-10 21:35:25.461708009 -0200
+++ L-1.23/src/Lcommandline_elliptic.cc	2010-11-10 21:35:32.065708275 -0200
@@ -121,11 +121,11 @@ void data_E(char *a1, char *a2, char *a3
 
 
     F = cgetg(6, t_VEC);
-    F[1] = lgeti(BIGDEFAULTPREC);
-    F[2] = lgeti(BIGDEFAULTPREC);
-    F[3] = lgeti(BIGDEFAULTPREC);
-    F[4] = lgeti(BIGDEFAULTPREC);
-    F[5] = lgeti(BIGDEFAULTPREC);
+    F[1] = (long)cgeti(BIGDEFAULTPREC);
+    F[2] = (long)cgeti(BIGDEFAULTPREC);
+    F[3] = (long)cgeti(BIGDEFAULTPREC);
+    F[4] = (long)cgeti(BIGDEFAULTPREC);
+    F[5] = (long)cgeti(BIGDEFAULTPREC);
 
     //gaffsg(a1,(GEN) F[1]);
     //gaffsg(a2,(GEN) F[2]);
--- L-1.23/src/Lcommandline.cc.orig	2012-01-23 21:29:04.756255578 -0200
+++ L-1.23/src/Lcommandline.cc	2012-01-23 21:29:47.660447013 -0200
@@ -30,6 +30,13 @@ Foundation, Inc., 59 Temple Place - Suit
 
 #include "Lcommandline.h"
 #include "cmdline.h"
+#include <pari/pari.h>
+
+/* No-operation error recovery routine for PARI.  This is needed for
+ * allocatemem(), which calls the error recovery routine (because
+ * allocatemem() destroys the PARI stack).
+ */
+void pari_err_recover_nop(long errnum) {return;}
 
 int main (int argc, char *argv[])
 {
@@ -473,7 +480,13 @@ int main (int argc, char *argv[])
 
 #ifdef INCLUDE_PARI
         if(do_elliptic_curve){
-             allocatemoremem((int) N_terms*16+1000000); //XXXXXXXXX this should depend on whether we're double or long double or mpfr double
+             /* allocatemem() calls the callback function cb_pari_err_recover(),
+              * which we temporarily change to do nothing. */
+             void (*saved_err_recover)(long) = cb_pari_err_recover;
+             cb_pari_err_recover = pari_err_recover_nop;
+             allocatemem(N_terms*16 + 1000000); //XXXXXXXXX this should depend on whether we're double or long double or mpfr double
+             cb_pari_err_recover = saved_err_recover;
+
              if (my_verbose>0) cout << "Will precompute " << N_terms << " elliptic L-function dirichlet coefficients..." << endl;
              initialize_new_L(a1,a2,a3,a4,a6,N_terms); 
         }
